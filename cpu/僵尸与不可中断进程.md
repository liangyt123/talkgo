# 僵尸状态与不可中断状态

linux进程状态

1.R Running/Runnable  //就绪队列中

2.D Disk sleep //表示和硬件交换 不可中断

3.Z Zombie //进程结束，父进程没有回收

4.S Interruptible Sleep //可中断状态睡眠，因为等待事件3被挂起

5.T Traced //调试跟踪状态

6.X Dead //死亡，在top/ps不能看见



## 僵尸状态

一个进程创建了子进程，父进程应该通过wait()/waitpid()等待子进程结束，而子进程在结束时候向父进程发送那个SIGCHLD信号，所以父进程还可以注册SIGCHLD函数，进行异步回收资源。

如果子进程执行太快，父进程没有跟上收尸，子进程就会变为Zombie。一般Zombie持续时间是短的，父进程回收资源后消失。或者父进程退出后，由init进程回收后消亡

一旦父进程没有处理子进程的终结，子进程就一直是Zombie, 大量的Zombie用尽进程号，导致新进程不能创建。

## 不可中断状态

系统为了保证进程和硬件数据一致性，进程会变为D状态，如果出现了大量的D或者长时间，就可能是系统出现了I/O问题



# 怎么分析

## 僵尸状态

1.通过top找到僵尸进程

2.通过pstree -aps 得到父进程

3.在父进程代码找收尸动作，修改bug



## 不可中断状态

1.判断系统状态，要善用top，top的关键介绍，看“某应用CPU达到100%怎么办”章节。通过top发现问题。

2.iowait问题需要观察状态D的进程，其中使用dstat查看系统io的具体是哪种操作（读,写,发送...）导致问题

3.通过pidstat -d 发现io情况,查看所有程序的io情况，得出哪个程序有问题

4.对程序的pid，进行strace -p ‘...pid’，记得用root权限，如果此时是root，却还是没有权限问题，就去看该进程的状态，很有可能是僵尸状态

5.通过perf record -g ，以及report进行查看io问题的原因，此时系统调用会显示问题函数，通过该提示，看源码，修复问题

















